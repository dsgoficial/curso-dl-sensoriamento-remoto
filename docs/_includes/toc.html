{% capture tocWorkspace %}
    {% comment %}
        Gerar automaticamente table of contents
    {% endcomment %}
    
    {% assign orderedList = include.ordered | default: false %}
    {% assign minHeader = include.h_min | default: 1 %}
    {% assign maxHeader = include.h_max | default: 6 %}
    {% assign nodes = include.html | split: '<h' %}
    
    {% assign firstHeader = true %}
    {% assign currLevel = 0 %}
    {% assign lastLevel = 0 %}
    
    {% capture listModifier %}{% if orderedList %}ol{% else %}ul{% endif %}{% endcapture %}
    
    {% for node in nodes %}
        {% if node == "" %}
            {% continue %}
        {% endif %}
        
        {% assign currLevel = node | replace: '"', '' | slice: 0, 1 | times: 1 %}
        
        {% if currLevel < minHeader or currLevel > maxHeader %}
            {% continue %}
        {% endif %}
        
        {% assign _workspace = node | split: '</h' %}
        {% assign _idWorkspace = _workspace[0] | split: 'id="' %}
        {% assign _idWorkspace = _idWorkspace[1] | split: '"' %}
        {% assign htmlID = _idWorkspace[0] %}
        
        {% assign _classWorkspace = _workspace[0] | split: 'class="' %}
        {% assign _classWorkspace = _classWorkspace[1] | split: '"' %}
        {% assign htmlClass = _classWorkspace[0] %}
        
        {% if htmlClass contains "no_toc" %}
            {% continue %}
        {% endif %}
        
        {% assign _workspace = _workspace[0] | split: '>' %}
        {% assign _workspace = _workspace[1] | strip %}
        {% assign header = _workspace %}
        
        {% if firstHeader %}
            {% assign minHeader = currLevel %}
        {% endif %}
        
        {% assign currLevel = currLevel | minus: minHeader | plus: 1 %}
        {% assign lastLevel = currLevel | plus: 0 %}
        
        {% if currLevel > lastLevel %}
            {% capture workspace %}{{ workspace }}<{{ listModifier }}>{% endcapture %}
        {% elsif currLevel < lastLevel %}
            {% assign repeatCount = lastLevel | minus: currLevel %}
            {% for i in (1..repeatCount) %}
                {% capture workspace %}{{ workspace }}</li></{{ listModifier }}>{% endcapture %}
            {% endfor %}
            {% capture workspace %}{{ workspace }}</li>{% endcapture %}
        {% elsif currLevel == lastLevel and firstHeader != true %}
            {% capture workspace %}{{ workspace }}</li>{% endcapture %}
        {% endif %}
        
        {% capture workspace %}{{ workspace }}<li><a href="#{{ htmlID }}">{{ header }}</a>{% endcapture %}
        
        {% assign lastLevel = currLevel %}
        {% assign firstHeader = false %}
    {% endfor %}
    
    {% assign repeatCount = lastLevel %}
    {% for i in (1..repeatCount) %}
        {% capture workspace %}{{ workspace }}</li></{{ listModifier }}>{% endcapture %}
    {% endfor %}
    
    {% if listModifier contains '</ol>' and workspace contains '<ol>' %}
        {% assign workspace = workspace | replace: '<ol>', '<ol>' | replace: '</ol>', '</ol>' %}
    {% endif %}
{% endcapture %}{{ workspace }}